# 技术指南：基于提示词与检索参数的AI应答优化

本技术指南为语料库系统优化提供专业指导，旨在帮助系统管理员通过**"检索测试"**功能，运用**提示词 (Prompts)** 和 **检索参数 (Retrieval Parameters)** 的精确配置，实现语料库AI应答质量的专业级优化。

---

## 1. AI工作原理分析

在进行系统优化之前，需要深入理解AI的核心工作机制。

### AI能看到什么信息？

在回答您的任何问题时，AI并非凭空想象，它所能参考的全部信息来源包括：  

*   **语料库的基本信息**：语料库的**名称**和**描述**。
*   **用户的“输入”**：用户当前发送的消息，以及之前的**对话历史（上下文）**。
*   **参考文档信息**：您上传的文档内容。
*   **管理员的提示词**：您在各个阶段为它设定的**提示词 (Prompts)**。

### AI如何回答问题？

一个看似简单的问答，AI在后台大致分三步走：  

1.  **初步改写与搜索**：AI首先结合上下文和您设定的“检索提示词”，将用户的原始问题改写成一个更适合机器搜索的查询，然后在语料库中进行初步搜索。
2.  **二次改写与精搜**：在第一轮的基础上，可能会进行更复杂的二次改写和精确搜索，以锁定最相关的知识节点。
3.  **整合与回答**：最后，AI将搜索到的内容，结合您设定的“回答提示词”，组织语言，生成最终的答案。

作为管理员，您无需关心复杂的中间过程，只需要聚焦于**优化检索和回答这两个阶段的提示词**，就能从根本上提升效果。

---

## 2. 优化三原则：从根源提升AI效果

请牢记以下三个核心原则，这是所有优化工作的基础。

### 原则一：语料库描述是必填项

**语料库的描述至关重要，必不可少！** 这是您为AI设定的最基础、最重要的全局背景。一个好的描述应该清晰地告诉AI：“这个语料库是关于什么的？”。这能极大地帮助AI在检索时框定范围，理解专有名词。

### 原则二：用“检索提示词”为AI编写“小抄”

**检索提示词（Query Instructions）** 的核心目标，是将用户的“口头语”精准地映射到您文档中的“书面语”。您需要在这里为AI编写一份“小抄”。

*   **解释业务术语**：告诉AI业务场景中的常见**缩写、别称、黑话**分别对应文档里的什么关键词。
    *   *示例*：“`“假条”就是指“请假申请单”，“年假”在文档中通常被称为“年度带薪休假”`”。
*   **提供联想线索**：引导AI根据用户问题联想到相关的实体和概念。
    *   *示例*：“`如果用户问及某个流程，应联想到该流程的负责人、所需材料和截止日期。`”

### 原则三：用“回答提示词”精确塑造输出

**回答提示词（Response Instructions）** 决定了AI的最终呈现。您需要像导演一样，明确告诉AI您想要什么。  

*   **指定格式**：`请用无序列表回答`、`请用表格形式呈现`。
*   **控制长短**：`回答请保持在100字以内`、`请尽可能详细地解释`。
*   **定义风格**：`请你扮演一位资深的技术支持专家`、`请用活泼、口语化的风格回答`。
*   **引用来源**：`你必须在回答的最后引用你参考的源文档名称`。

---

## 3. 核心工具：检索测试 (Retrieval Test)

在语料库的“管理”界面中，找到“检索测试”标签页。这里是您进行一切优化工作的“实验室”。

### 界面概览

“检索测试”界面主要分为三个区域：  
1.  **第一个标签页：配置区**
    *   您可以在这里输入测试问题，并对所有的提示词和召回参数进行实时调整。
2.  **第二个标签页：召回节点查看区**
    *   这里会展示AI根据您的配置生成的最终答案和引用的源知识节点。
3.  **第三个标签页：检索配置区**
    *   这里可以对召回参数进行精细化调整。

### 提示词的艺术

![](imgs/2025-07-08-23-26-51.png)

#### 查询改写提示词 (Query Instructions)  
*   **作用**：指导AI如何“更好地理解”用户的原始问题，为AI编写“小抄”。（参考原则二）
*   **示例**：“`你是一个聪明的IT帮助台助理。用户的“开会软件”通常指Teams，“VPN”是指公司的Cisco AnyConnect。当用户问到账户问题，应联想到密码重置、双因素认证（MFA）。`”

#### 响应生成提示词 (Response Instructions)  
*   **作用**：指导AI如何“组织语言并生成最终答案”。（参考原则三）
*   **示例**：“`请以一名资深HR的身份，使用严谨、专业的语言进行回答。如果涉及到步骤，请使用1, 2, 3的格式。最后必须附上引用的文档来源。`”

#### 兜底提示词 (Fallback Prompt)  
*   **作用**：当AI在语料库中**找不到任何相关内容**时，它会说这段话。可以添加联系方式。
*   **示例**：“`抱歉，我在语料库中没有找到相关信息。您可以尝试换个问法，或联系ITSO服务台0755 842-73333获取帮助。`”

### 召回参数的精妙控制：一门权衡的艺术  

![](imgs/2025-07-08-23-26-41.png)

调整召回参数就像在走钢丝，需要在“宁缺毋滥”和“宁滥勿缺”之间找到最佳平衡点。

*   **核心参数：Top K**  
    *   **作用**：第一道“海选”门槛，决定初步筛选出多少个候选节点。

*   **质量把关：Rerank (重排序)**
    *   **Rerank开关**：强烈建议**保持开启**，它会用更精密的模型进行二次筛选。
    *   **Rerank Cutoff (相似度阈值)**： “复试”分数线。这是**最需要精细调优**的参数。
    *   **Rerank Top K (最终录取数)**：最终用来生成答案的节点数量。

*   **权衡的艺术：一个例子**  
    *   **场景**：假设有一个“办事大厅”语料库，文档数量极多。
    *   **困境一**：如果 `Top K` 设置过高（如25），会导致召回大量不相关的“噪音”文档，反而干扰AI的最终判断。
    *   **此时对策**：您可能需要**调高 `Rerank Cutoff`**（如从0.4到0.5），让筛选标准更严格，只留下最相关的精华内容。
    *   **困境二**：但如果 `Cutoff` 设置得**过高**，又可能导致一些虽然相关、但表述略有不同的文档，因为差一点没达到分数线而被“误杀”，导致AI回答时缺少关键信息。
    *   **结论**：您需要通过反复测试，找到一个最适合您语料库数据分布的“黄金分割点”。

*   **模式选择：Hybrid vs. Semantic**  
    *   **Hybrid (混合模式)**：**推荐的默认选项**。结合了语义理解和关键词匹配，效果最均衡。
    *   **Semantic (语义模式)**：纯粹靠理解“意思”来检索，适合处理口语化、无固定关键词的查询。

*   **网络搜索开关 (Use Web Search)**  
    *   **作用**：这是一个强大的补充开关，决定了AI在回答时，是否被允许从公共互联网搜索信息作为补充。
    *   **何时关闭（默认）**：对于内容稳定、不常变化的业务场景（如内部规章制度、特定项目的历史文档），强烈建议关闭。这可以确保AI的回答严格来源于您上传的权威文档，避免外部信息的干扰和“幻觉”。
    *   **何时开启**：对于技术类语料库，或任何需要结合外部最新信息、不局限于校内信息的场景，可以考虑开启。例如，询问某个开源软件的最新用法，开启网络搜索能获得更及时的答案。

*   **引用来源开关 (Show Reference)**  
    *   **重要前提**：此开关**不控制权限**！它只影响**已经有权访问**语料库的用户所看到的界面。它绝不会让无权用户看到源文档。
    *   **作用**：决定了AI在生成回答后，是否要附上它所参考的源文档链接。
    *   **何时开启（默认建议）**：为了方便有权限的用户溯源和核对信息，建议保持开启。这在绝大多数业务场景中都是一个好习惯，能提升答案的可信度。
    *   **何时关闭**：如果您追求一个极致简洁的对话界面，不希望有任何额外的链接干扰，或者参考的源文档本身排版比较混乱不适合直接展示，可以考虑关闭。

---

## 4. 实战演练：通用问题排查流程

当遇到AI回答错误时，请遵循以下标准流程进行排查：

**第一步：找到目标文档**  
首先，您自己作为这个领域的专家，要明确知道哪个或哪些文档里包含了正确答案。

**第二步：进入“检索测试”页面进行复现**  
使用用户的问题，或者您认为更标准的问题，进行一次测试。

**第三步：分析召回结果**  
这是最关键的一步。查看右侧“召回节点查看区”的源节点列表：

*   **Case A：成功找到了目标文档/节点，但最终回答错误**  
    *   **病因**：AI“看”到了正确的材料，但“理解”错了业务场景，或者“表达”能力不行。
    *   **药方**：问题出在**提示词**。返回去优化**“查询改写提示词”**（帮它更好地理解）或**“响应生成提示词”**（帮它更好地表达）。

*   **Case B：未能找到目标文档/节点**  
    *   **病因**：这通常有两种可能。
    *   **病因 1：搜索关键词错误**。AI改写的查询与文档中的实际表述不匹配。
        *   **药方**：这是典型的“小抄”没写好。去优化**“查询改写提示词”**，建立用户常用语和文档关键字的映射。
    *   **病因 2：文档被埋没**。相关文档在初步海选中因为得分不够高，被其他海量“噪音”文档挤掉了。
        *   **药方**：这是典型的参数问题。尝试**调高 `Rerank Cutoff`** 阈值，让筛选更严格，从而过滤掉噪音，使真正相关的文档能“浮出水面”。

---

## 5. 保存您的成果

> **⚠️ 重要提示**
> 您在“检索测试”页面调整的所有参数**仅用于本次测试**，是临时的，不会自动保存！
> 
> 为了让这些优化在整个语料库中永久生效，您必须手动前往**“语料库设置”**页面，找到对应的配置项，再次输入并保存这些参数。

完成这一步，您的所有努力才会真正应用到所有用户的问答体验中。 